def CONTAINER_NAME="docker_apache"
def CONTAINER_TAG="v1"

def buildVersionString() {
    return '1.0_' + env.BUILD_NUMBER
}


def imageRemove(containerName){
    try {
        sh "docker stop $containerName"
        sh "docker rm $containerName"
        sh "docker rmi $containerName"
    } catch(error){}
}

def imageBuild(containerName, tag){
    sh "docker build -t $containerName:$tag --pull --no-cache ."
    echo "Image build complete"
}

def runApp(containerName, tag){
    sh "docker run -d --rm -p 80:80 --name $containerName $containerName:$tag"
    echo "Application started"
}



pipeline {
    agent any

    stages {
        stage("Image Remove"){
            steps {
                echo "============          Remove Previous      ============"
                echo "============    Docker Container / Image   ============"
                imageRemove(CONTAINER_NAME)
            }
        }
       	stage('Image Build'){
            steps {
                echo "============ Select dockerfile from GitHub ============"
                echo "============        & Build Image          ============"
                dir('docker_file') {
                    imageBuild(CONTAINER_NAME, CONTAINER_TAG)
                }
		    }
	    } 

    }
}
